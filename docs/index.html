<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afinador Crom√°tico de Violino</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéª</text></svg>">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; /* Desativa o zoom por duplo toque em dispositivos m√≥veis */
        }
        /* Estilo para a agulha do afinador */
        #needle {
            transform-origin: bottom center;
            transition: transform 0.2s ease-out;
        }
        /* Estilo para corda ativa/sugerida */
        .string-button.active {
            /* A cor do anel ser√° definida dinamicamente via JS */
            @apply ring-4;
        }
        /* Estilo para o volume meter */
        #volume-meter-bar {
            transition: width 0.1s ease-out;
        }
        /* Estilo para o modal */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-md bg-gray-800 rounded-2xl shadow-2xl p-6 sm:p-8 text-center space-y-6">

        <h1 class="text-3xl font-bold text-teal-400">Afinador de Violino</h1>

        <!-- Se√ß√£o de Temas Removida -->

        <div id="status-message" class="h-10 flex items-center justify-center">
            <p class="text-gray-400">Clique em "Iniciar" para come√ßar</p>
        </div>

        <div class="relative w-full h-40 bg-gray-900/50 rounded-lg overflow-hidden flex items-end justify-center">
            <!-- Linha central -->
            <div id="center-line" class="absolute top-0 bottom-0 w-1 bg-gray-500/50" style="left: 50%; transform: translateX(-50%);"></div>
            
            <!-- Agulha do afinador -->
            <div id="needle" class="absolute bottom-0 w-1 h-2/3 bg-gray-400 rounded-t-full" style="transform: rotate(0deg);"></div>

            <!-- Indicadores de cents -->
            <div class="absolute bottom-4 text-xs text-gray-400" style="left: 50%; transform: translateX(-50%);">0</div>
            <div class="absolute bottom-4 text-xs text-gray-500" style="left: 25%; transform: translateX(-50%);">-50</div>
            <div class="absolute bottom-4 text-xs text-gray-500" style="left: 75%; transform: translateX(-50%);">+50</div>

            <!-- Volume Meter -->
            <div class="absolute top-2 left-2 right-2 h-4 bg-gray-700 rounded-full overflow-hidden">
                <div id="volume-meter-bar" class="h-full bg-blue-400 rounded-full" style="width: 0%;"></div>
            </div>
        </div>

        <div class="flex items-center justify-center space-x-2">
            <div id="note-name" class="text-8xl font-black text-white tracking-tighter">--</div>
            <div class="flex flex-col text-left">
                <div id="note-sharp-flat" class="text-2xl font-bold text-gray-400 h-8"></div>
                <div id="note-octave" class="text-2xl font-bold text-gray-500"></div>
            </div>
        </div>
        
        <div id="frequency-display" class="text-lg text-gray-400 h-6">Frequ√™ncia: --- Hz</div>

        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4">
            <!-- Bot√µes das cordas com IDs para f√°cil acesso -->
            <div class="flex flex-col items-center">
                <button id="string-G3" class="string-button w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-2 rounded-lg transition-all duration-150">G3 (Sol)</button>
            </div>
            <div class="flex flex-col items-center">
                <button id="string-D4" class="string-button w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-2 rounded-lg transition-all duration-150">D4 (R√©)</button>
            </div>
            <div class="flex flex-col items-center">
                <button id="string-A4" class="string-button w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-2 rounded-lg transition-all duration-150">A4 (L√°)</button>
            </div>
            <div class="flex flex-col items-center">
                <button id="string-E5" class="string-button w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-2 rounded-lg transition-all duration-150">E5 (Mi)</button>
            </div>
        </div>

        <button id="toggle-btn" class="w-full bg-teal-500 hover:bg-teal-600 text-gray-900 font-bold py-4 px-4 rounded-xl transition-all duration-200 ease-in-out transform hover:scale-105 shadow-lg">
            Iniciar
        </button>

        <button id="help-btn" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl transition-all duration-200 ease-in-out transform hover:scale-105 shadow-lg mt-3">
            Ajuda
        </button>
    </div>

    <!-- Modal de Ajuda -->
    <div id="help-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-overlay">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-lg relative text-left space-y-4">
            <h2 class="text-2xl font-bold text-blue-400 mb-4">Como Usar o Afinador</h2>
            <p class="text-gray-300">
                Este afinador de violino foi projetado para ajud√°-lo a afinar seu instrumento de forma precisa e intuitiva.
            </p>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li>
                    <strong>Iniciar/Parar:</strong> Clique no bot√£o "Iniciar" para ativar o microfone e come√ßar a afina√ß√£o. Clique novamente para parar.
                </li>
                <li>
                    <strong>Sequ√™ncia de Afina√ß√£o:</strong> O afinador o guiar√° pela sequ√™ncia padr√£o das cordas do violino (G3, D4, A4, E5). A corda atual a ser afinada estar√° destacada.
                </li>
                <li>
                    <strong>Indicador de Afina√ß√£o:</strong> A agulha central indica o qu√£o perto voc√™ est√° da afina√ß√£o ideal.
                    <ul class="list-circle list-inside ml-4 mt-1">
                        <li>
                            <span class="text-green-400">Verde:</span> Corda afinada (dentro de +/- 5 cents).
                        </li>
                        <li>
                            <span class="text-red-400">Vermelho:</span> Corda fora de afina√ß√£o ou nota incorreta.
                        </li>
                        <li>
                            <span class="text-gray-400">Cinza:</span> Perto da afina√ß√£o, mas ainda precisa de ajuste.
                        </li>
                    </ul>
                </li>
                <li>
                    <strong>Volume do Microfone:</strong> A barra azul no topo do afinador mostra o n√≠vel de volume captado pelo microfone.
                </li>
            </ul>
            <button id="close-modal-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-gray-900 font-bold py-3 px-4 rounded-xl transition-all duration-200 ease-in-out shadow-lg mt-4">
                Entendi
            </button>
        </div>
    </div>

    <script>
        // --- Elementos do DOM ---
        const appContainer = document.getElementById('app-container');
        const noteNameEl = document.getElementById('note-name');
        const noteSharpFlatEl = document.getElementById('note-sharp-flat');
        const noteOctaveEl = document.getElementById('note-octave');
        const toggleBtn = document.getElementById('toggle-btn');
        const needle = document.getElementById('needle');
        const statusMessageEl = document.getElementById('status-message');
        const frequencyDisplayEl = document.getElementById('frequency-display');
        const stringButtons = {
            'G3': document.getElementById('string-G3'),
            'D4': document.getElementById('string-D4'),
            'A4': document.getElementById('string-A4'),
            'E5': document.getElementById('string-E5')
        };
        const allStringButtons = document.querySelectorAll('.string-button');
        const volumeMeterBar = document.getElementById('volume-meter-bar');
        const helpBtn = document.getElementById('help-btn');
        const helpModal = document.getElementById('help-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const centerLine = document.getElementById('center-line');

        // --- Vari√°veis de √Åudio e Estado ---
        let audioContext;
        let analyser;
        let mediaStreamSource;
        let buffer;
        let isRunning = false;
        const noteStrings = ["D√≥", "D√≥‚ôØ", "R√©", "R√©‚ôØ", "Mi", "F√°", "F√°‚ôØ", "Sol", "Sol‚ôØ", "L√°", "L√°‚ôØ", "Si"];
        
        const violinStrings = {
            'G3': { name: 'Sol', octave: 3, frequency: 195.998 },
            'D4': { name: 'R√©', octave: 4, frequency: 293.665 },
            'A4': { name: 'L√°', octave: 4, frequency: 440.000 },
            'E5': { name: 'Mi', octave: 5, frequency: 659.255 }
        };
        
        const tuningSequence = ['G3', 'D4', 'A4', 'E5'];
        let currentStringIndex = 0;
        let stringTunedState = { 'G3': false, 'D4': false, 'A4': false, 'E5': false };
        let tuningComplete = false;

        const CENTS_HISTORY_SIZE = 5;
        let centsHistory = [];

        // Cores espec√≠ficas para cada corda
        const stringColors = {
            'G3': { base: 'red-500', accent: 'red-400' },
            'D4': { base: 'yellow-500', accent: 'yellow-400' },
            'A4': { base: 'blue-500', accent: 'blue-400' },
            'E5': { base: 'green-500', accent: 'green-400' }
        };

        // --- Fun√ß√µes Auxiliares de √Åudio ---
        function playTunedSound() {
            if (audioContext) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                
                oscillator.start(audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.5); 
                oscillator.stop(audioContext.currentTime + 0.5);
            }
        }

        // --- Fun√ß√µes Principais ---
        async function toggleTuner() {
            if (isRunning) {
                stopTuner();
            } else {
                await startTuner();
            }
        }

        async function startTuner() {
            try {
                if (audioContext && audioContext.state === 'suspended') {
                    await audioContext.resume();
                } else if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }

                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                if (!stream.active) {
                    throw new Error('O stream do microfone n√£o est√° ativo.');
                }

                mediaStreamSource = audioContext.createMediaStreamSource(stream);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 2048;
                buffer = new Float32Array(analyser.fftSize);
                
                mediaStreamSource.connect(analyser);

                isRunning = true;
                updateUIOnStart();
                initializeTuningSequence();
                analysePitch();
                console.log('Afinador iniciado. Contexto de √°udio:', audioContext.state);
            } catch (err) {
                console.error('Erro ao aceder ao microfone:', err);
                let errorMessage = 'Erro ao aceder ao microfone.';
                if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                    errorMessage = 'Acesso ao microfone negado. Por favor, permita o acesso ao microfone nas configura√ß√µes do seu navegador.';
                } else if (err.name === 'NotFoundError') {
                    errorMessage = 'Nenhum microfone encontrado. Verifique se um microfone est√° conectado e funcionando.';
                } else if (err.name === 'NotReadableError') {
                    errorMessage = 'O microfone est√° a ser usado por outra aplica√ß√£o. Por favor, feche-a e tente novamente.';
                }
                statusMessageEl.textContent = errorMessage;
                statusMessageEl.classList.add('text-red-400');
                toggleBtn.textContent = 'Iniciar';
                toggleBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                toggleBtn.classList.add('bg-teal-500', 'hover:bg-teal-600');
            }
        }

        function stopTuner() {
            if (mediaStreamSource) {
                mediaStreamSource.mediaStream.getTracks().forEach(track => track.stop());
            }
            if (audioContext) {
                audioContext.suspend();
            }
            isRunning = false;
            updateUIOnStop();
            centsHistory = [];
            console.log('Afinador parado. Contexto de √°udio:', audioContext ? audioContext.state : 'fechado');
        }

        function analysePitch() {
            if (!isRunning || !analyser || !audioContext || audioContext.state !== 'running') return;

            analyser.getFloatTimeDomainData(buffer);

            let sumSquares = 0;
            for (let i = 0; i < buffer.length; i++) {
                sumSquares += buffer[i] * buffer[i];
            }
            const rms = Math.sqrt(sumSquares / buffer.length);
            
            const volumeWidth = Math.min(100, rms * 500);
            volumeMeterBar.style.width = `${volumeWidth}%`;

            const fundamentalFreq = getPitchAutoCorrelation(buffer, audioContext.sampleRate);

            if (fundamentalFreq > 0) {
                const noteData = getNoteData(fundamentalFreq);
                
                centsHistory.push(noteData.cents);
                if (centsHistory.length > CENTS_HISTORY_SIZE) {
                    centsHistory.shift();
                }
                const averagedCents = centsHistory.reduce((a, b) => a + b, 0) / centsHistory.length;

                updateUINote({ ...noteData, cents: averagedCents }, fundamentalFreq);
            } else {
                resetUINoteDisplay();
                statusMessageEl.textContent = 'Nenhuma nota detectada. Toque uma corda.';
                statusMessageEl.classList.remove('text-green-400', 'text-blue-400', 'text-red-400', 'text-yellow-400');
                statusMessageEl.classList.add('text-red-400');
                centsHistory = [];
            }
            
            requestAnimationFrame(analysePitch);
        }

        function getPitchAutoCorrelation(buffer, sampleRate) {
            const minFreq = 80;
            const maxFreq = 800;
            const minPeriod = sampleRate / maxFreq;
            const maxPeriod = sampleRate / minFreq;

            const n = buffer.length;
            const autoCorrelation = new Float32Array(n);

            for (let lag = 0; lag < n; lag++) {
                let sum = 0;
                for (let i = 0; i < n - lag; i++) {
                    sum += buffer[i] * buffer[i + lag];
                }
                autoCorrelation[lag] = sum;
            }

            let maxVal = -1;
            let peakIndex = -1;

            for (let i = Math.floor(minPeriod); i < Math.min(n, Math.ceil(maxPeriod)); i++) {
                if (autoCorrelation[i] > maxVal) {
                    maxVal = autoCorrelation[i];
                    peakIndex = i;
                }
            }

            if (peakIndex <= 0) {
                return -1;
            }

            let x0 = peakIndex - 1;
            let x1 = peakIndex;
            let x2 = peakIndex + 1;

            if (x0 < 0 || x2 >= n) {
                return sampleRate / peakIndex;
            }

            let s0 = autoCorrelation[x0];
            let s1 = autoCorrelation[x1];
            let s2 = autoCorrelation[x2];

            let shift = 0.5 * (s0 - s2) / (s0 - 2 * s1 + s2);
            let finalIndex = x1 + shift;

            if (finalIndex > 0) {
                return sampleRate / finalIndex;
            }
            return -1;
        }

        function getNoteData(frequency) {
            const noteNum = 12 * (Math.log(frequency / 440) / Math.log(2));
            const roundedNoteNum = Math.round(noteNum) + 69;
            const idealFrequency = 440 * Math.pow(2, (roundedNoteNum - 69) / 12);
            const cents = 1200 * (Math.log(frequency / idealFrequency) / Math.log(2));
            
            return {
                name: noteStrings[roundedNoteNum % 12],
                octave: Math.floor(roundedNoteNum / 12) - 1,
                cents: cents
            };
        }

        // --- Fun√ß√µes de UI ---

        function updateUIOnStart() {
            toggleBtn.textContent = 'Parar';
            toggleBtn.classList.remove('bg-teal-500', 'hover:bg-teal-600');
            toggleBtn.classList.add('bg-red-500', 'hover:bg-red-600');
            statusMessageEl.textContent = 'A ouvir...';
            statusMessageEl.classList.remove('text-red-400');
            tuningComplete = false;
        }

        function updateUIOnStop() {
            toggleBtn.textContent = 'Iniciar';
            toggleBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
            toggleBtn.classList.add('bg-teal-500', 'hover:bg-teal-600');
            statusMessageEl.textContent = 'Clique em "Iniciar" para come√ßar';
            resetUINoteDisplay();
            resetStringButtons(); // Reseta completamente os bot√µes ao parar
            currentStringIndex = 0;
            tuningComplete = false;
            volumeMeterBar.style.width = '0%';
        }

        function resetUINoteDisplay() {
            noteNameEl.textContent = '--';
            noteSharpFlatEl.textContent = '';
            noteOctaveEl.textContent = '';
            needle.style.transform = 'rotate(0deg)';
            needle.style.backgroundColor = '#4a5568'; // gray-700
            noteNameEl.style.color = '#ffffff'; // white
            frequencyDisplayEl.textContent = 'Frequ√™ncia: --- Hz';
            centerLine.classList.remove('bg-red-500/50', 'bg-yellow-500/50', 'bg-blue-500/50', 'bg-green-500/50');
            centerLine.classList.add('bg-gray-500/50');
        }

        /**
         * Reseta o estado visual de todos os bot√µes das cordas.
         * Agora, as cordas afinadas permanecem com sua cor correspondente.
         */
        function resetStringButtons() {
            allStringButtons.forEach(button => {
                button.classList.remove('active'); // Sempre remove 'active'
                // Remove todas as classes de anel de cor
                button.classList.remove('ring-red-400', 'ring-yellow-400', 'ring-blue-400', 'ring-green-400'); 
                
                const stringKey = Object.keys(stringButtons).find(key => stringButtons[key] === button);
                const currentColor = stringColors[stringKey] ? stringColors[stringKey].base : 'gray-700';

                // Se a corda N√ÉO estiver afinada, reseta para o estilo padr√£o cinza
                if (!button.classList.contains('tuned')) {
                    button.classList.remove('bg-red-500', 'bg-yellow-500', 'bg-blue-500', 'bg-green-500'); // Remove cores espec√≠ficas
                    button.classList.add('bg-gray-700', 'hover:bg-gray-600', 'text-white');
                } else {
                    // Se a corda J√Å estiver afinada, garante que ela mantenha a cor base correspondente
                    button.classList.remove('bg-gray-700', 'hover:bg-gray-600'); // Remove cinza
                    button.classList.add(`bg-${currentColor}`); // Adiciona a cor base da corda
                    button.classList.add('text-white'); // Garante texto branco
                }
            });
        }

        function initializeTuningSequence() {
            stringTunedState = { 'G3': false, 'D4': false, 'A4': false, 'E5': false };
            resetStringButtons();
            currentStringIndex = 0;
            tuningComplete = false;
            highlightCurrentString();
        }

        function highlightCurrentString() {
            resetStringButtons(); // Remove o destaque 'active' das cordas anteriores

            if (currentStringIndex < tuningSequence.length) {
                const currentStringKey = tuningSequence[currentStringIndex];
                const currentColorAccent = stringColors[currentStringKey].accent;

                stringButtons[currentStringKey].classList.add('active');
                stringButtons[currentStringKey].classList.add(`ring-${currentColorAccent}`);

                statusMessageEl.textContent = `Afine a corda ${stringButtons[currentStringKey].textContent.split(' ')[0]} (${stringButtons[currentStringKey].textContent.split(' ')[1].replace(/[()]/g, '')})`;
                statusMessageEl.classList.remove('text-red-400', 'text-yellow-400', 'text-blue-400', 'text-green-400', 'text-gray-400');
                statusMessageEl.classList.add(`text-${currentColorAccent}`);

                centerLine.classList.remove('bg-red-500/50', 'bg-yellow-500/50', 'bg-blue-500/50', 'bg-green-500/50', 'bg-gray-500/50');
                centerLine.classList.add(`bg-${currentColorAccent}/50`);

            } else {
                statusMessageEl.textContent = 'Violino Afinad√≠ssimo! üéâ';
                statusMessageEl.classList.remove('text-red-400', 'text-yellow-400', 'text-blue-400', 'text-green-400', 'text-gray-400');
                statusMessageEl.classList.add('text-green-400');
                tuningComplete = true;
                centerLine.classList.remove('bg-red-500/50', 'bg-yellow-500/50', 'bg-blue-500/50', 'bg-green-500/50', 'bg-gray-500/50');
                centerLine.classList.add('bg-green-500/50');
            }
        }
        
        function updateUINote(noteData, frequency) {
            const currentStringKey = tuningSequence[currentStringIndex];
            const targetStringData = violinStrings[currentStringKey];
            const currentStringColors = stringColors[currentStringKey];
            const currentAccentColor = currentStringColors ? currentStringColors.accent : 'gray-400';
            const currentBaseColor = currentStringColors ? currentStringColors.base : 'gray-700';

            noteNameEl.textContent = noteData.name.split('‚ôØ')[0];
            noteSharpFlatEl.textContent = noteData.name.split('‚ôØ').length > 1 ? '‚ôØ' : '';
            noteOctaveEl.textContent = noteData.octave;
            frequencyDisplayEl.textContent = `Frequ√™ncia: ${frequency.toFixed(2)} Hz`;

            const clampedCents = Math.max(-50, Math.min(50, noteData.cents));
            const rotation = (clampedCents / 50) * 60;
            needle.style.transform = `rotate(${rotation}deg)`;

            if (!tuningComplete) {
                if (noteData.name === targetStringData.name && noteData.octave === targetStringData.octave) {
                    if (Math.abs(clampedCents) < 5) { // Afinada (dentro de +/- 5 cents)
                        needle.style.backgroundColor = '#10b981'; // green-500
                        noteNameEl.style.color = '#10b981';
                        noteSharpFlatEl.style.color = '#10b981';

                        if (!stringTunedState[currentStringKey]) {
                            stringTunedState[currentStringKey] = true;
                            stringButtons[currentStringKey].classList.add('tuned');
                            stringButtons[currentStringKey].classList.remove('active');
                            stringButtons[currentStringKey].classList.remove(`ring-${currentAccentColor}`); // Remove a cor do anel
                            
                            // Aplica a cor base da corda ao bot√£o quando afinada
                            stringButtons[currentStringKey].classList.remove('bg-gray-700', 'hover:bg-gray-600');
                            stringButtons[currentStringKey].classList.add(`bg-${currentBaseColor}`);
                            stringButtons[currentStringKey].classList.add('text-white'); // Garante texto branco

                            playTunedSound();
                            statusMessageEl.textContent = `Corda ${stringButtons[currentStringKey].textContent.split(' ')[0]} Afinada! ‚úÖ`;
                            statusMessageEl.classList.remove('text-red-400', 'text-yellow-400', 'text-blue-400', 'text-green-400', 'text-gray-400');
                            statusMessageEl.classList.add('text-green-400');

                            setTimeout(() => {
                                currentStringIndex++;
                                highlightCurrentString();
                                resetUINoteDisplay();
                            }, 1500);
                        }
                    } else { // Perto, mas n√£o afinada
                        needle.style.backgroundColor = `var(--tw-colors-${currentAccentColor.replace('-', '')})`;
                        noteNameEl.style.color = `var(--tw-colors-${currentAccentColor.replace('-', '')})`;
                        noteSharpFlatEl.style.color = `var(--tw-colors-${currentAccentColor.replace('-', '')})`;
                        statusMessageEl.textContent = `Afine a corda ${stringButtons[currentStringKey].textContent.split(' ')[0]} (${clampedCents.toFixed(0)} cents)`;
                        statusMessageEl.classList.remove('text-red-400', 'text-yellow-400', 'text-blue-400', 'text-green-400', 'text-gray-400');
                        statusMessageEl.classList.add(`text-${currentAccentColor}`);
                    }
                } else { // N√£o √© a corda atual ou est√° muito fora
                    needle.style.backgroundColor = '#f87171'; // red-400
                    noteNameEl.style.color = '#f87171';
                    noteSharpFlatEl.style.color = '#f87171';
                    statusMessageEl.textContent = `Procure a corda ${stringButtons[currentStringKey].textContent.split(' ')[0]} (${stringButtons[currentStringKey].textContent.split(' ')[1].replace(/[()]/g, '')})`;
                    statusMessageEl.classList.remove('text-red-400', 'text-yellow-400', 'text-blue-400', 'text-green-400', 'text-gray-400');
                    statusMessageEl.classList.add('text-red-400');
                }
            } else { // Modo crom√°tico ap√≥s todas as cordas estarem afinadas
                needle.style.backgroundColor = '#2dd4bf'; // teal-400 (cor neutra para modo crom√°tico)
                noteNameEl.style.color = '#2dd4bf';
                noteSharpFlatEl.style.color = '#2dd4bf';
            }
        }

        // --- Event Listeners ---
        toggleBtn.addEventListener('click', toggleTuner);
        helpBtn.addEventListener('click', () => helpModal.classList.remove('hidden'));
        closeModalBtn.addEventListener('click', () => helpModal.classList.add('hidden'));

        // Inicializa√ß√£o ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            resetUINoteDisplay();
            resetStringButtons();
        });

    </script>
</body>
</html>
